---
title: "test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=10) 
library(tidyverse)
library(devtools)
library(nflscrapR)
library(teamcolors)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars, echo=FALSE, warning=FALSE}


#setwd("~/Documents/GitHub/GDAT515/aclark-Assignment2")
setwd("C:/Users/Alex_Clark/Documents/aclark-assignment2-master")
kc_color <- teamcolors %>%
  filter(league == "nfl") %>%
  filter(name == "Kansas City Chiefs")

#pbp_2019 <- scrape_season_play_by_play(2019, "reg", teams = "KC")

#write.csv(pbp_2019, "pbp2019.csv", row.names = FALSE)

pbp_2019 <- read.csv("pbp2019.csv")

plyr_lkup <- read.csv("player_no_pos.csv", fileEncoding="UTF-8-BOM")

mahomes_only <- pbp_2019 %>% filter(posteam == "KC" & passer_player_name == "P.Mahomes" & sack == 0) %>% drop_na(receiver_player_name, air_yards)

air_yards <- mahomes_only %>% group_by(receiver_player_name, receiver_player_id) %>% summarise(count = n(), air_yards = mean(air_yards)) %>%
  rename(Name = receiver_player_name, Id = receiver_player_id)

location_pass <- mahomes_only %>%
  group_by(receiver_player_name, receiver_player_id, pass_location) %>%
  summarise(count = n()) %>%
  pivot_wider(names_from = pass_location, values_from = count) %>%
  replace(is.na(.), 0)

locale <- data.frame(locale = colnames(location_pass[3:5])[max.col(location_pass[3:5],ties.method="first")])

air_yards <- bind_cols(air_yards, locale)

set.seed(223)
air_yards_left <- air_yards %>% filter(locale == 'left')
air_yards_left$locale_num <- runif(nrow(air_yards_left), min=1, max=5)
air_yards_middle <- air_yards %>% filter(locale == 'middle') %>% mutate(locale_num = 0)
air_yards_right <- air_yards %>% filter(locale == 'right')
air_yards_right$locale_num <- runif(nrow(air_yards_right), min=-5, max=-1)

air_yards <- bind_rows(air_yards_left, air_yards_middle, air_yards_right)
patrick_mahomes <- mahomes_only %>%
  select(passer_player_name, passer_player_id) %>%
  distinct() %>%
  mutate(count = 0, air_yards = -0.2, locale = "middle", locale_num = 0) %>%
  rename(Name = passer_player_name, Id = passer_player_id)

air_yards <- bind_rows(air_yards, patrick_mahomes)

air_yards <- merge(air_yards, plyr_lkup)


ggplot(data = air_yards, aes(x=air_yards, y =locale_num)) +
  geom_vline(xintercept = 0, linetype = "solid",colour = "black", alpha = .7) +
  geom_vline(xintercept = 1:21, linetype = "solid",colour = "white", alpha = .3) +
  geom_vline(xintercept = 10, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 20, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 10, linetype = "solid",colour = "yellow", alpha = .7) +
  geom_hline(yintercept = .45, linetype = "dashed",colour = "white") +
  geom_hline(yintercept = -.45, linetype = "dashed",colour = "white") +
  geom_text(aes(label=Name),hjust=0.4, vjust=-1.5, angle = 0, fontface = "bold") +
  geom_point(aes(shape = Pos),size = 10, color = unique(kc_color$primary)) +
  scale_shape_manual(values =c(25,19,15,18)) +
  geom_text(aes(label=No),hjust=0.5, vjust=0.5, colour = "black", size = 4, fontface = "bold") +
  theme(panel.background = element_rect(fill = "#7cfc00",
                                        colour = "#7cfc00"),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       axis.title.y =element_blank(),
       axis.text.y=element_blank(),
       axis.ticks.y=element_blank(),
       plot.title = element_text(hjust = 0.5),
       plot.subtitle = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) +
  xlab("Average Air Yards") +
  ggtitle("Patrick Mahomes 2019 Targets", subtitle = "Average Air Yards From Release Point") +
  labs(shape = "Position") +
  annotate("text", x = -.3, y = -1.5, label = "Release Point", angle = 90) +
  annotate("text", x = 9.7, y = 4.3, label = "First Down", angle = 90)
```

## Including Plots

You can also embed plots, for example:

```{r car, echo=FALSE, warning=FALSE}
all_mahomes <- mahomes_only %>% select(pass_location, air_yards, incomplete_pass)
all_passes_left <- all_mahomes %>% filter(pass_location == 'left')
all_passes_left$pass_location <- runif(nrow(all_passes_left), min=1, max=5)
all_passes_middle <- all_mahomes %>% filter(pass_location == 'middle')
all_passes_middle$pass_location <- runif(nrow(all_passes_middle), min=-.99, max=.99)
all_passes_right <- all_mahomes %>% filter(pass_location == 'right')
all_passes_right$pass_location <- runif(nrow(all_passes_right), min=-5, max=-1)

all_passes <- bind_rows(all_passes_left, all_passes_middle, all_passes_right)
all_passes$incomplete_pass <- ifelse(all_passes$incomplete_pass == 1, "Incomplete", "Complete")
all_passes$incomplete_pass <- as.factor(all_passes$incomplete_pass)

ggplot(data = all_passes, aes(x=air_yards, y =pass_location, shape = incomplete_pass, color = incomplete_pass)) +
  geom_vline(xintercept = -10, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 0, linetype = "solid",colour = "black", alpha = 1) +
  geom_vline(xintercept = -10:52, linetype = "solid",colour = "white", alpha = .3) +
  geom_vline(xintercept = 10, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 20, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 30, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 40, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 50, linetype = "solid",colour = "white") +
  geom_vline(xintercept = 10, linetype = "solid",colour = "yellow", alpha = .7) +
  geom_hline(yintercept = .45, linetype = "dashed",colour = "white") +
  geom_hline(yintercept = -.45, linetype = "dashed",colour = "white") +
  geom_point(size = 6, alpha = .5) +
  geom_point(aes(x=0, y=0), colour="black", shape = 18, size = 7) +
  scale_shape_manual(values =c(15,16)) +
  scale_color_manual(breaks = c("0","1"),
                     values=c("blue", "red")) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 6), limits = c(-10,52)) +
  theme(panel.background = element_rect(fill = "#7cfc00",
                                        colour = "#7cfc00"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.y =element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.title = element_blank()) +
  #scale_x_continuous(breaks = scales::pretty_breaks(n = 3)) +
  xlab("Yardage") +
  ggtitle("Patrick Mahomes All Passes", subtitle = "2019 Passes from Release Point, Colored and Shaped by Completion") +
  annotate("text", x = -.6, y = -4.6, label = "Release Point", angle = 90, fontface = "bold") +
  annotate("text", x = 9.3, y = 4.3, label = "First Down", angle = 90, fontface = "bold") +
  annotate("text", x = -3, y = -.5, label = "Pat Mahomes", angle = 45, size = 3, fontface = "bold")

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
